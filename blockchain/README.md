# 区块链接口详细说明

## 概述

本系统的区块链接口负责与部署在区块链上的智能合约进行交互，主要包括以下功能：

1. 投票证明的提交和验证
2. 投票结果的存储和查询
3. 事件日志记录和监听
4. 区块链网络连接管理

## 核心组件

### 1. 智能合约 (Vote.sol)

智能合约是整个系统的核心，负责：

- 存储投票选项和计票结果
- 验证零知识证明
- 防止重复投票（通过nullifier机制）
- 记录投票事件

主要函数：
- `submitVote()`: 提交投票证明
- `verifyProof()`: 验证零知识证明
- `getOption()`: 获取选项信息
- `getTotalVotes()`: 获取总票数

### 2. 区块链连接模块 (blockchain-interface.ts)

该模块负责与区块链网络通信：

- 连接以太坊网络（支持本地测试网和主网）
- 部署和管理智能合约
- 调用合约函数
- 监听合约事件

### 3. ZKP证明管理模块 (zkp-manager.ts)

该模块负责处理零知识证明：

- 验证证明格式
- 提交证明到区块链
- 批量处理证明

### 4. 投票结果管理模块 (vote-result-manager.ts)

该模块负责处理投票结果：

- 查询投票统计数据
- 实时监听结果更新
- 格式化结果输出

### 5. 事件日志模块 (event-logger.ts)

该模块负责事件处理：

- 监听区块链事件
- 记录投票事件日志
- 事件过滤和统计

## 工作流程

1. **投票提交**：
   - 用户在前端选择投票选项
   - 前端生成ZKP证明
   - 通过混合网络将证明提交到后端
   - 后端验证证明并提交到区块链

2. **证明验证**：
   - 链下验证：在提交前验证证明格式和基本条件
   - 链上验证：通过智能合约验证证明的有效性

3. **结果查询**：
   - 前端或后端通过接口查询投票结果
   - 从区块链获取最新数据
   - 格式化并返回结果

4. **事件监听**：
   - 系统监听区块链上的投票事件
   - 记录事件日志
   - 实时更新投票统计

## 安全特性

1. **匿名性**：
   - 投票内容通过ZKP保护，验证者无法知道具体选择
   - 防重标识确保一人一票，但不暴露用户身份

2. **防重机制**：
   - 使用nullifier防止重复投票
   - 每个nullifier只能使用一次

3. **数据完整性**：
   - 区块链确保数据不可篡改
   - 智能合约确保验证逻辑一致

## 部署和配置

1. **网络配置**：
   - 支持本地测试网络（Hardhat）
   - 可配置主网和测试网连接

2. **合约部署**：
   - 使用Hardhat进行合约编译和部署
   - 支持自动化部署脚本

3. **环境变量**：
   - 私钥管理
   - 网络配置参数